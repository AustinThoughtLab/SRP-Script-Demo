<!DOCTYPE html>
<html>
    <head>
        <title>My experiment</title>
		<script src="jspsych-6.0.5/jspsych.js"></script>
		<script src="jspsych-6.0.5/plugins/jspsych-survey-text.js"></script>
		<script src="jspsych-6.0.5/plugins/jspsych-html-keyboard-response.js"></script>
		<script src="jspsych-6.0.5/plugins/jspsych-audio-keyboard-response.js"></script>
		<link href="jspsych-6.0.5/css/jspsych.css" rel="stylesheet" type="text/css"></link>
    </head>
    <body></body>
	<script>
    //next steps://
      //get the file to save with participant_ID//
      //get habituation audio to play at the same time as fixation cross//
		//create timeline array//
		var timeline = [];
		//input and store particpant info//
		var participant_info = {
		  type: 'survey-text',
		  questions: [
        {prompt: "Subject Number", name: "subject_number"},
		    {prompt: "Participant ID", name: "participant_ID"}
		  ],
		  on_finish: function(data){
			  var responses = JSON.parse(data.responses);
			  var subject_number = responses.Q0;
			  var participant_id = responses.Q1;
			  jsPsych.data.addProperties({subjectNumber: subject_number, participantID: participant_id});
		  }
		};

		//welcome message//
		var welcome = {
			type: 'html-keyboard-response',
			stimulus: 'Welcome to the experiment! Press any key to begin.'
		};

		//description of what the subject is about to hear (pretraining)//
		var pretraining_instructions = {
			type: "html-keyboard-response",
	    	stimulus: "<p>You are about to hear two types of tones, a short tone and a long tone.</p>" +
	              "<p>After each tone, a screen will tell you what type of tone it was.</p>" +
	              "<p>Press any key to begin.</p>"
		};

    //pretraining phase: showing participants short tones and a long tones//
    var pretraining = {
      timeline: [
        {
          type: 'html-keyboard-response',
    		  stimulus: 'This is a short tone.',
    		  choices: jsPsych.NO_KEYS,
    		  trial_duration: 1500
        },
        {
          type: "audio-keyboard-response",
          stimulus: "sound/1s.mp3",
          choices: jsPsych.NO_KEYS,
          prompt: "<div style='float: left;'><img src='img/blue.png'></img>",
          trial_ends_after_audio: true
        },
        {
    		  type: 'html-keyboard-response',
    		  stimulus: '<div style="font-size:60px;">+</div>',
    		  choices: jsPsych.NO_KEYS,
    		  trial_duration: 3000
    		},
        {
          type: 'html-keyboard-response',
    		  stimulus: 'This is a long tone.',
    		  choices: jsPsych.NO_KEYS,
    		  trial_duration: 1500
        },
        {
          type: "audio-keyboard-response",
          stimulus: "sound/4s.mp3",
          choices: jsPsych.NO_KEYS,
          prompt: "<div style='float: left;'><img src='img/blue.png'></img>",
          trial_ends_after_audio: true
        },
        {
    		  type: 'html-keyboard-response',
    		  stimulus: '<div style="font-size:60px;">+</div>',
    		  choices: jsPsych.NO_KEYS,
    		  trial_duration: 3000
    		}
      ],
      repetitions: 5
    }

    //training instructions will go here//

    //training phase will go here//

		//description of what the subject is about to hear (test)//
		var test_instructions = {
		  type: "html-keyboard-response",
		    stimulus: "<p>Now you're going to choose if the tone you hear is short or long.</p>" +
		            "<p>Press 'f' if you think the tone you hear sounds more like the short tone.</p>" +
		            "<p>Press 'j' if you think the tone you hear sounds more like the long tone.</p>" +
		            "<p>Press any key to begin.</p>"
		};

		//array for different test stimuli//
		var test_stimuli = [
		  { audio: "sound/1.5s.mp3"},
		  { audio: "sound/2s.mp3"},
      { audio: "sound/2.5s.mp3"},
      { audio: "sound/3s.mp3"},
      {audio: "sound/3.5s.mp3"}
		];

		//fixation cross for test (longer)//
		var test_fixation = {
		  type: 'html-keyboard-response',
		  stimulus: '<div style="font-size:60px;">+</div>',
		  choices: jsPsych.NO_KEYS,
		  trial_duration: 3000
		}

    var stim = {
      type: "audio-keyboard-response",
      stimulus: jsPsych.timelineVariable('audio'),
      choices: jsPsych.NO_KEYS,
      prompt: "<div style='float: left;'><img src='img/blue.png'></img>",
      trial_ends_after_audio: true
    }

    var trial = {
      type: "html-keyboard-response",
      stimulus: '',
      choices: ['f', 'j'],
      prompt: "<div style='float: left;'><img src='img/blue.png'></img>",
    }

		var test_procedure = {
		  timeline: [test_fixation, stim, trial],
		  timeline_variables: test_stimuli,
		  repetitions: 3,
		  randomize_order: true
		}

	  //end message//
	    var ending = {
	      	type: "html-keyboard-response",
	      	stimulus: "<p>Thank you for participating in this game! You can go get your sticker and prize now!</p>"
	    };

      timeline.push(participant_info);
      timeline.push(welcome);
  		timeline.push(pretraining_instructions);
      timeline.push(pretraining);
      //training_instructions
      //training
      timeline.push(test_instructions);
  		timeline.push(test_procedure);
	    timeline.push(ending);

		jsPsych.init({
			timeline: timeline,
			use_webaudio: false,
			preload_audio: ['sound/1s.mp3', 'sound/1.5s.mp3', 'sound/2s.mp3', 'sound/2.5s.mp3', 'sound/3s.mp3', 'sound/3.5s.mp3', 'sound/4s.mp3'],
      on_finish: function(data){
        jsPsych.data.get().localSave('csv','subject_number.csv'); // Saves a file on the computer running the experiment. First localSave argument is the format, second is the filename.
      }
		})
	</script>
</html>
